<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p
	{margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:.5in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:.5in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
.MsoChpDefault
	{font-family:"Calibri","sans-serif";}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:107%;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US>

<div class=WordSection1>

<p class=MsoNormal><b><span style='font-family:"Times New Roman","serif"'>Th&#7921;c
hành c&#7845;u hình managed identity cho m&#7897;t máy &#7843;o VM &#273;&#7875;
truy c&#7853;p vào</span></b></p>

<p class=MsoNormal><b><span style='font-family:"Times New Roman","serif"'>Azure
storage Account không c&#7847;n Access key </span></b></p>

<p class=MsoNormal><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif"'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:"Times New Roman","serif"'>Click
vào Linux VM &gt; Click vào menu Identity&gt; Click On&gt; Click Save &#273;&#7875;
l&#432;u l&#7841;i c&#7845;u hình:</span></b></p>

<p class=MsoListParagraphCxSpMiddle><span style='position:absolute;z-index:
251659264;left:0px;margin-left:49px;margin-top:385px;width:118px;height:34px'><img
width=118 height=34
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image001.png"></span><span
style='position:absolute;z-index:251661312;left:0px;margin-left:386px;
margin-top:245px;width:84px;height:34px'><img width=84 height=34
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image002.png"></span><span
style='position:absolute;z-index:251663360;left:0px;margin-left:322px;
margin-top:164px;width:79px;height:36px'><img width=79 height=36
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image003.png"></span><span
style='font-family:"Times New Roman","serif"'><img width=656 height=449
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image004.jpg"></span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif"'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:"Times New Roman","serif"'>Click
Yes</span></b></p>

<p class=MsoListParagraphCxSpMiddle><span style='position:absolute;z-index:
251665408;left:0px;margin-left:244px;margin-top:82px;width:65px;height:33px'><img
width=65 height=33
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image005.png"></span><span
style='font-family:"Times New Roman","serif"'><img width=454 height=259
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image006.jpg"></span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif"'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:"Times New Roman","serif"'>Click
Azure role assignments:</span></b></p>

<p class=MsoListParagraphCxSpMiddle><span style='position:absolute;z-index:
251667456;left:0px;margin-left:263px;margin-top:234px;width:156px;height:33px'><img
width=156 height=33
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image007.png"></span><span
style='font-family:"Times New Roman","serif"'><img width=624 height=347
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image008.jpg"></span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif"'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:"Times New Roman","serif"'>Click
vào Add role assignment &gt; ch&#7885;n Scope: Storage, Subscription: &lt;Your
Subscription&gt;,  </span></b></p>

<p class=MsoListParagraphCxSpMiddle><b><span style='font-family:"Times New Roman","serif"'>Resource: 
&lt;Your Storage Account&gt;, Role: Contributor &gt; click Save. </span></b></p>

<p class=MsoListParagraphCxSpMiddle><span style='position:absolute;z-index:
251677696;left:0px;margin-left:275px;margin-top:240px;width:182px;height:30px'><img
width=182 height=30
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image009.png"></span><span
style='position:absolute;z-index:251675648;left:0px;margin-left:275px;
margin-top:193px;width:182px;height:30px'><img width=182 height=30
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image009.png"></span><span
style='position:absolute;z-index:251673600;left:0px;margin-left:274px;
margin-top:149px;width:182px;height:30px'><img width=182 height=30
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image009.png"></span><span
style='position:absolute;z-index:251671552;left:0px;margin-left:274px;
margin-top:102px;width:182px;height:30px'><img width=182 height=30
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image009.png"></span><span
style='position:absolute;z-index:251669504;left:0px;margin-left:61px;
margin-top:94px;width:166px;height:33px'><img width=166 height=33
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image010.png"></span><span
style='font-family:"Times New Roman","serif"'><img width=634 height=432
src="Th&#7921;c%20hành%20c&#7845;u%20hình%20managed%20identity%20cho%20m&#7897;t%20máy%20&#7843;o%20VM%20&#273;&#7875;%20truy%20c&#7853;p%20vào%20Azure%20storage%20Account%20không%20c&#7847;n%20Access%20key_files/image011.jpg"></span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif"'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:"Times New Roman","serif"'>Vào
cloud shell&gt; ch&#7885;n Bash Shell&gt; SSh vào Linux VM : ssh
Your_username@public_IP_VM</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif"'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:"Times New Roman","serif"'>Trong
Linux VM th&#7921;c hi&#7879;n các b&#432;&#7899;c sau:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:.75in;text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif"'>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:"Times New Roman","serif"'>Setup
Azure CLI:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span style='font-family:"Times New Roman","serif"'>Ch&#7841;y l&#7879;nh
sau &#273;&#7875; thêm Microsoft Azure CLI repository (L&#7879;nh này s&#7869;
t&#7843;i và cài &#273;&#7863;t gói deb c&#7911;a Azure CLI.):</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif"'>curl -sL
https://aka.ms/InstallAzureCLIDeb | sudo bash</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span style='font-family:"Times New Roman","serif"'>Cài &#273;&#7863;t
Azure CLI b&#7857;ng l&#7879;nh:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif"'>sudo apt-get install azure-cli</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span style='font-family:"Times New Roman","serif"'>Ki&#7875;m tra
xem Azure CLI &#273;ã &#273;&#432;&#7907;c cài &#273;&#7863;t thành công
ch&#432;a b&#7857;ng l&#7879;nh:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif"'>az  version</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:.75in;text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif"'>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:"Times New Roman","serif"'>Ki&#7875;m
tra xem t&#7915; bên trong máy &#7843;o VM này  có th&#7875; truy c&#7853;p
vào  Azure storage Account không c&#7847;n Access key không, th&#7921;c hi&#7879;n
các b&#432;&#7899;c sau:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span style='font-family:"Times New Roman","serif";color:#374151'>Xác
th&#7921;c vào Azure s&#7917; d&#7909;ng Managed Identity c&#7911;a máy &#7843;o
(VM) mà b&#7841;n &#273;ang ch&#7841;y, s&#7917; d&#7909;ng l&#7879;nh sau</span></b><b><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>az login  --identity</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'><span
style='color:#0F0F0F'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:"Times New Roman","serif";color:#0F0F0F'>Li&#7879;t
kê t&#7845;t c&#7843; các blobs( Ho&#7863;c containers) có trong m&#7897;t
Storage Account:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'> az storage
container list --account-name &lt;YourStorageAccountName&gt; --query
&quot;[].name&quot; --output tsv</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'><span
style='color:#0F0F0F'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:"Times New Roman","serif";color:#0F0F0F'>Li&#7879;t
kê t&#7845;t c&#7843; các file có trong m&#7897;t blobs c&#7909; th&#7875;:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>az storage blob
list --account-name &lt;YourStorageAccountName&gt; --container-name &lt;YourContainerName&gt;
--output table</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'><span
style='color:#0F0F0F'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:"Times New Roman","serif";color:#0F0F0F'>T&#7841;o
m&#7897;t file txt trong máy &#7843;o VM:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>echo Hello world
&gt; test.txt</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'><span
style='color:#0F0F0F'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:"Times New Roman","serif";color:#0F0F0F'>Th&#7917;
test upload m&#7897;t file t&#7915; máy ch&#7911; Linux lên m&#7897;t blob c&#7909;
th&#7875;:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>az storage blob
upload --account-name &lt;YourStorageAccountName&gt;  --container-name &lt;YourContainerName&gt; 
--file &lt;YourFileName&gt;</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'><span
style='color:#0F0F0F'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:"Times New Roman","serif";color:#0F0F0F'>Th&#7917;
download m&#7897;t file t&#7915; blob v&#7873; máy &#7843;o VM:</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>az storage blob
download --account-name &lt;storage-account&gt;  --container-name
&lt;container&gt; --name myFile.txt --file &lt;~/destination/path/for/file&gt;</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>Vào Resource Group
&gt;  Click Storage Account&gt; Click Containers &gt; Click your container-name
&#273;&#7875; ki&#7875;m tra file &#273;ã upload t&#7915; máy &#7843;o VM lên</span></p>

<p class=MsoListParagraphCxSpMiddle><span style='font-family:"Times New Roman","serif";
color:#0F0F0F'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><b><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>8.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><b><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>Chúc m&#7915;ng b&#7841;n
&#273;ã hoàn thành bài LAB</span></b></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif";color:#0F0F0F'> </span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:1.0in'><span
style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoListParagraph><span style='font-family:"Times New Roman","serif"'> 
</span></p>

</div>

</body>

</html>
